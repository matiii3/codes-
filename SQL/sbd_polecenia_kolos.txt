-------zadanie 1------------
Podaj polecenie SQL, które wyświetli nazwy, lata produkcji oraz czasy trwania programów dostępnych dla dzieci poniżej 7 roku życia (czyli z ograniczeniem wiekowym "bez ograniczeń"), nie trwających dłużej niż 1h. Weź pod uwagę tylko te programy, które są emitowane w odcinkach (mają one w nazwie skrót "odc."). Wynik zapytania uporządkuj wg czasów trwania (od najdłuższych do najkrótszych), programy o identycznych czasach trwania uporządkuj wg nazw i lat produkcji rosnąco.


SELECT nazwa, rok_produkcji, czas_trwania_w_minutach
FROM sbd_programy
WHERE ograniczee_wiekowe = 'bez ograniczeń'
AND czas_trwania_w_minutach <= 60
AND nazwa LIKE '%odc.%'
ORDER BY czas_trwania_w_minutach DESC, nazwa ASC, rok_produkcji ASC

-------zadanie 2------------
Podaj polecenie SQL, które wyświetli nazwy ograniczeń wiekowych wraz z liczbą programów z danym ograniczeniem. W zbiorze wynikowym zapytania powinny się znaleźć tylko te ograniczenia wiekowe, dla których średni czas trwania programów jest dłuższy niż 20 minut. Wynik zapytania posortuj wg nazwy ograniczenia wiekowego w porządku rosnącym.

-------zadanie 3------------
Podaj polecenie SQL wyświetlające nazwy tych kanałów, dla których średni czas trwania emitowanych programów jest dłuższy niż średni czas trwania programów emitowanych przez kanał "TVP 1" Wynik posortuj wg nazw kanałów.

select nazwa_kanalu
from sbd_harmonogramy_emisji h join sbd_programy p
on h.id_programu = p.id_programu
having avg(p.czas_trwania_w_minutach) >
(SELECT avg(czas_trwania_w_minutach)
from
sbd_harmonogramy_emisji h2 join sbd_programy p2
on h2.id_programu = p2.id_programu
where h2.nazwa_kanalu in ('TVP 1'))
group by nazwa_kanalu
order by nazwa_kanalu

-------zadanie 4------------
2 p.) Podaj polecenie SQL, które doda do relacji SBD_KATEGORIE nową kolumnę o nazwie LICZBA_PROGRAMOW, przechowującą liczby całkowite większe lub równe 0.
2. (2 p.) Następnie podaj polecenie SQL, które wypełni dodaną w p. 1. kolumnę wartościami, określającymi liczbę programów danej kategorii. Uwaga! Jeśli w danej kategorii nie ma żadnego programu, kategoria ta w kolumnie LICZBA_PROGRAMOW powinna mieć ustawioną wartość 0.

ALTER TABLE sbd_kategorie
ADD COLUMN liczba_programow INT DEFAULT 0;


-------zadanie 5------------
(4 p.) Zaprojektuj perspektywę (podaj polecenie SQL DDL, które ją utworzy) o nazwie SBD_ANALIZA_KANALOW_V, które pozwoli wyświetlić zestawienie liczby kanałów (kolumna LICZBA_KANALOW) wg zdefiniowanych powyżej kategorii (kolumna KATEGORIA). Dodatkowo dla każdej kategorii podaj średni "wiek" kanałów z danej kategorii liczony w roku 2024 (dokonaj zaokrąglenia do pełnych lat, kolumna SREDNI_WIEK).
2. (1 p.) Podaj dowolne polecenie SQL, które użyje zaprojektowanej przez Ciebie perspektywy


CREATE OR REPLACE VIEW SBD_ANALIZA_KANALOW_V AS
SELECT
CASE
WHEN k.rok_zalozenia < 2000 THEN 'zalozone przed 2000'
WHEN k.rok_zalozenia > 2010 THEN 'zalozone po 2010'
ELSE 'zalozone w latach od 2000 do 2010'
END AS kategoria,
COUNT(k.nazwa) AS liczba_kanalow,
ROUND(AVG(EXTRACT(YEAR FROM SYSDATE) - k.rok_zalozenia)) AS sredni_wiek
FROM
sbd_kanały k
INNER JOIN
sbd_harmonogramy_emisji he ON k.nazwa = he.nazwa_kanalu
GROUP BY
CASE
WHEN k.rok_zalozenia < 2000 THEN 'zalozone przed 2000'
WHEN k.rok_zalozenia > 2010 THEN 'zalozone po 2010'
ELSE 'zalozone w latach od 2000 do 2010'
END;

-------zadanie 7------------
Zaprojektuj relację (podaj polecenie SQL DDL, które ją utworzy) o nazwie SBD_OCENY_WIDZOW, która umożliwi składowanie ocen widzów poszczególnych programów. Relacja powinna składować adres e-mail widza, który dokonał oceny programu, datę oceny, samą ocenę jako liczbę całkowitą w zakresie od 1 do 10 oraz opcjonalne, dodatkowe uwagi widza dotyczące ocenianego programu. Wskazanie programu, który widz ocenia, powinno zostać zrealizowane przez odpowiednio zaprojektowany klucz obcy, wiążący projektowaną relację z relacją SBD_PROGRAMY. Uwaga! Klucz podstawowy tej relacji powinien zapewniać, że dany widz może ocenić dany program tylko jeden raz.
2. (1 p.) Podaj polecenia SQL, które wstawią do utworzonej relacji dwa rekordy, opisujące oceny widzów wybranego przez Ciebie programu.


-- Tworzenie tabeli
CREATE TABLE SBD_OCENY_WIDZOW (
email_widza VARCHAR2(255) NOT NULL,
id_programu NUMBER(10) NOT NULL,
data_oceny DATE DEFAULT SYSDATE NOT NULL,
ocena NUMBER(1) CHECK (ocena BETWEEN 1 AND 10) NOT NULL,
uwagi CLOB,
PRIMARY KEY (email_widza, id_programu),
FOREIGN KEY (id_programu) REFERENCES SBD_PROGRAMY(id_programu)
);

-- Wstawienie przykładowych rekordów
INSERT INTO SBD_OCENY_WIDZOW (email_widza, id_programu, ocena, uwagi)
VALUES ('jan.kowalski@example.com', 101, 8, 'Świetny program, polecam!');

INSERT INTO SBD_OCENY_WIDZOW (email_widza, id_programu, ocena, uwagi)
VALUES ('anna.nowak@example.com', 102, 5, 'Program mógłby być lepszy, średnio mi się podobał.');